- tests redesign
- filter tests by status
- results fail show row diff
- overall design: cards min-max width
=========================================================================================================
- Create Analysis Test button - enable after evaluate
- Analysis exam - show submited answer sql
- Test Results (synthesis/analysis) - show submited data to teacher
- Exercise: (handle bad query + save query)
=======================================================================================================================================
Mozda ne bi bilo lose da svuda pozivas ExecuteSQL (da izbacis ExecuteSQLAsAdmin, AsReadonlyAdmin - ovo treba svakako izbaciti) 
i onda u BaseController razresiti SqlUserName, SqlPassword
ili to izvuci u servis


synthesis test - change status modal not closing on success

- Assign students
  2. assign: keiranje sql usera + mapiranje na azure usera

- (odradi test i kreiraj analysis test) => analysis tests ekran:
  1. reload logika za ajax endpoint
  2. dodaj dto, citaj creatad by detalje sa ms graph

=============================================================================================================================
Open templates page, stop & start server, create new template (triggers reload) -> handle missing ms graph permissions in ajax call, send appropriate response to client (custom http code) and refresh page from client side
moment.js => map Created On to local time
encrypt assign students url
graph api filtering (encode, remove whitespaces)
order by
UI: marked count & enable (assign marked btn), pagination show max n page buttons, disable checkboxes for already assigned (and set tooltip - make sure to initialize)
redirect (reload) if missing permisssions  (stop server while on page): on all ms graph endpoints
=============================================================================================================================
=============================================================================================================================
=============================================================================================================================


graph api
SetupScript for SQL server (enable contained DB + create login for readonly)
prof. kada definise solution ne bi trebao da moze da modifikuje bazu - readonly user na nivou sql servera za ove situacije

=============================================================================================================================
data tables should say no recrods when empty
mssqlService - metode tipa create database koje vracaju samo succcess (bool) treba da uloguju gresku ako je resultat false
display full sql result (messages + multiple tables)
error messages when sql execution fails (e.g. attempt create table when defining task solution)
Delete
sprecavanje zloupotrebe
Auth (Azure AD) + sql users
Paginations
Unit tests, DTO validations, AutoMapper, Sql Commands, Generic repository
================================================================================================================
-created by + createdDate (autoMapper)
_. pre nego sto se job stavi u Queue proveriti da nije vec tamo 
_. ne cuvas u bazi kad status predje u queued, saljes samo frontu (signalR) -> nadji u kodu : EvaluationProgress.Queued (EvaluateController)

_. edit tabele kroz UI, red u tabeli se trazi kao match vrednosti svake kolone 
   problem 1: kada postoje 2 reda sa identicnim vrednostima edit/delete utice na oba reda
   problem 2: (za neke vrednosti) kod nekih sql tipova poredjenje vrednosti  moze da bude problem (vrednost koja se prikazuje u tabeli nije uvek onog formata kog treba da bude u where statement-u)
   uvesti konvenciju da svaka tabela ima Id (int, unique)?: potrebna valdacija, nemoguce validirati na FE (los ux)
_. Security: Sql injection - treba staviti sql command gde je moguce + svaki user aplikacije da ima svog sql user-a koji ce biti admin samo na svojim bazama
_. Feature: Brisanje (Templates, Tasks, Synthesis Tests...): npr. ne dozvoliti brisanje template-a ako postoji task kreiran na osnovu njega (BE validacija + proveriti da sama baza ovo (kaskadno brisanje) ne dozvoljava)
_. Kada raditi i da li cleanup kloniranih baza? Ili da se to radi kroz brisanje na delete dugme (npr brisanje exam-a)
_. kako spreciti da neko drugi ne radi umesto studenta (lozinka za test, aplikacija na lokalnoj mrezi, analiza ip adresa) - generator velikih stringova, niz sledeci na osonovu prethodnog, nemoguce pogoditi sledeceg u nizu - u paraleli desktop + web
_. Auth: list student users when assigning test to students (azure - graph api), createdBy & ModifiedBy, students should see only what is assigned to them, teachers share, sql users - users mapping

Bug: kada se uradi evaluacija synthesis mora reload da bi se aktivirali dugmici za create analysis
Bug: ako brzi radis refresh vidi se kako se tabela iscrtava (npr templates strana) - hide-uj tabelu i uradi show kada se zavrsi iscrtavanje

SignalR:request filters won't log here + status evaluating spinner bigger than other icons (take spinner from azure) + hiding message when signalR reconeccted (fade-out + table should not move)
BUG: pisanje resenja: validacija da zahteva ime kolone (neophodno je da bi se lakse radilo poredjenje rezultata)
BUG: create template model - kada se kreira prva tabela ona se pojavi u dropdown-u ali ne moze da se selektuje (ili je vec selektovana) da se vidi njena struktura.
     verovatno je slicno kada se pise resenje za bazu koja ima samo jednu tabelu
     Isto i kada se radi edit modela (cak i kada ima vise tabela)- prva je selektovana ali se ne vidi json ispod

_. mozda ne klonirati baze na assign synthesis - klonirace se i za studente koji ne dodju. Ako ostaje clone na assign synthesis verovatno ne treba da bude bulk.
   klonirati kada student pocne? - veliki load ako 30 studenata pocne u isto vreme


Handle syntax errors in sql editor (in response)

review CloneDatabase sa fail if exist true (tu je verovatno problem sto nije reentrant - ako clone uspe a db save failuje zaglavljeni smo i ne mozemo da probamo opet)
verovatno svi pozivi treba da imaju false		

API/StudentController/AssignStudents: _microsoftSQLService.CloneDatabases(test.Task.NameOnServer !!!! - zar ne bi trebalo test.task.TEMPLATE.NameOnServer)
sta ako neki assgnmenti ne uspeju
	- ako failuje clone

Nice to have:
------------
student kada radi analysis: restore baze na original (nice to have)
UX improvement: brisanje (umesto dugmeta selektabilni red i delete na tastaturi), dodavanje (enter dok je neko od polja iz poslednjeg reda tj. iz reda za insert u fokusu)
FE (create Template/Task/Test + set Template/Task description): FE validations (name/description not empty or taken + Template/Task selected when creating Task/Test)
Data celija (templates i tasks tabele): 5 records in 3 tables
Model celija (templates tablela): 4 columns in 2 tables
ekran Kreiranje resenja(Tasks -> solution): mozda staviti rezultat upita i struktura baze u 2 taba
wait screen kada se modifikuje data neke tabele (Data.cshtml)(ne iscrtavati ponovo table header)
razmisli o 2 vrste resulta kao response na front:
 - data result (kada se radi neki get podataka IsSuccess, Data, Errors)
 - operation result kada se radi neki update ili insert (IsSuccess, Errors) - data treba da se update-uje novim get-om

===================================================================================================================================================
***************************************************************************************************************************************************
===================================================================================================================================================
-??? load profesorovog resenja nakon sto je sacuvano

Logical validations
====================
- profesorovo resenje za sintezu (sql) ne trebalo da se menja nakon sto pocne bar jedan test (zbog imena kolona tj. formata resenja)

LOGOVANJE: File sistem, sql server, baza - odvojeni sistemi koji nisu transakcija
=================================================================================
- uvek treba znati sta se desilo (sev 1)
- kriticni scenariji (radi se update template-a na tasku, obrise se postojeci template, novi ne uspe da se klonira - npr neko je sa servera obrisao bazu novog templejta i nema odakle da se klonira) koji uzrokuju greske u sistemu treba da budu neki alert (nije dovoljno samo da se uloguju) ili makar da se izdvoje kao kriticne greske
- pitanje da li se sve moze ulogovati (create ili update template, baza se klonira, ne uspe upis u bazu - task ostaje vezan za stari template)
- search: Console.WriteLine($"NOT implemented: log delete database {cloneDataNameOnServer} failed")
- Create template: _microsoftSQLService.CreateDatabase treba da uloguje poruku od sql servera ukoliko ne moze da kreira bazu na serveru

Define template model
=====================
- izvrsavanje skripta nad postojecom bazom
- prikaz trenutnog modela https://www.google.com/search?q=jquery+json+viewer&rlz=1C1GCEA_enRS826RS826&oq=jquery+json+vire&aqs=chrome.1.69i57j0l5.7072j0j7&sourceid=chrome&ie=UTF-8
- sql sintaska
- go (split u vise skripti) https://stackoverflow.com/questions/40814/execute-a-large-sql-script-with-go-commands


Create database
===========================================================================
- TEXTAREA: sql syntax, horizontal scroll, undo, responsive
- transformacija inputa u pravilan sql (izbaci whitespace-ove)
- Verifikacija upita
- modali

Modify database data
===========================================================================
- UX: kada se radi insert edit delete da kratko zasvetli novi red, editovana celija ili red koji se brise (ili samo wait screen preko cele tabele)
- type converter (poseban fajl)
- where statement po primarnom kljucu https://stackoverflow.com/questions/3930338/sql-server-get-table-primary-key-using-sql-query
- bootstrap css - dropdown ne radi lepo (kada se spusti nema desne ivice) - kada se odzumira radi
- treba search za dropdown
- json optimizacija (jedan niz kolone i ostalo data - a ne "kolona":"data")
- vertikalni scroll za tabelu
- esacapovani - kada se posalju treba da budu originalni (unescapeoveani) + da li se kao edit racuna kada se promeni unescape u esacape
- where statement treba da proveri count 1

INSERT NE IDE NA NEKE KOLONE (autogenerated): za tabelu ('AWBuildVersion') moze preko ovog upita
SELECT name FROM sys.identity_columns WHERE object_id = OBJECT_ID('AWBuildVersion') (isto i za rowversion i timestamp tipove)

Tasks & Templates
=================
- na taskuovima, kada se radi update template-a (FE pozovi API samo ako izabraniTemplate != stariTemplate)
- created by, created date
- uradi delete (mdf i ldf bi trebali da se obrisu (sa bazom). Brisu se kada se baza obrise iz sql servera (proveri da li se brisu i kada se obrise baza preko aplikacije))
-izvuci zajednicko u htmlu u partial-e (modali za update name, updaate description, delete)
-izvuci zajednicko u js-u u helper metode

Tasks
===========
- izvuci iz diplomskog i implementiraj kloniranje baze !!! + kod update template-a isto i dodatno brisanje postojece baze
- gde god ima ovako brisanje baze treba da se nakon toga proveri da li baza postoji. Ako postoji (neuspesno brisanje) to treba da se uloguje negde !
- Create template: dto validation (Name not empty), db validations (ne postoji vec sa istim imenom u bazi), responseDTO (umesto entity)
- Update description: dto validation (Description not empty), responseDTO (umesto entity)
- Update description: dto validation (Name not empty), db validations (ne postoji vec sa istim imenom), responseDTO (umesto entity)
- Set SqlScript: dto validation (SqlScript: not empty), implement GetCreatingDatabases, 	
- FE validacije na modalima
- Format resenja: kolone resenja moraju imati imena, imena moraju biti jedinstvena!!!!! - na ovo se oslanja 
- Tacan upit (prof. resenje) - pre nego sto se upit submituje provera (format izlaza i format resenja, bar jedan red u resenju)

Templates
===========
- FE validacije na modalima
- change template, on show, scroll to item with class active


Code refactoring
=================
- postavi AsNoTracking da bude default
- izvuci sql tipove u neki enum (na vise mesta hardkodovani stringovi tipova tipa "nvarchar")
- Sql Expression builder (ovaj kod se ponavlja):
	var columnValuesWhere = recordPrevious.Select(x => $"[{x.ColumnName}] = '{x.Value}'");
	var whereExpr = string.Join(" and ", columnValuesWhere);
GetAdminConnParams - vidi gde se sve koristi, preispitaj
- //AutoMapper (add AutoMapper)
- FE profesor: (template, tasks, synthesis test i vrv analysis) - svi imaju update name modal (centralizuj kod)